<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-header-panel/paper-header-panel.html">

<link rel="import" href="contact-card.html">
<link rel="import" href="contact-small-card.html">


<dom-module id="app-element">
  	<template>
    	<style>

      paper-toolbar{
        background-color:#175A69;
        border-radius: 0.5%;

      }
      .main-title{
        font-family: 'Roboto', 'Noto', sans-serif;
        font-size: 2em;
        float:left;
      }
      .pagination-buttons{
        width:12.5em;
        margin-left:40%;
      }
      .page-number{
        display: inline;
      }
      .icon-next,.icon-previous{
        color: #000000;
        float: center;
        height: 3.125em;
        width: 3.125em;
      }
      .icon-next:hover,.icon-previous:hover{
        color: #AAB8C2;
        float: center;
        transform: scale(1.5);
      }
      .first-container{
        background: #BDB37D;
        float:left;
        height: 100%;
        margin: 1em; 
        padding:1.25em;
        width: 75%;

      }
      .second-container{
        float:left;
        margin: 0 1em ;
        width: 15%;
      }
      contact-small-card{
        display: block;
      }

    	</style>
      <iron-ajax
      auto
      url='http://api.randomuser.me/?page={{page}}&results={{count}}&seed=foobar'
      last-response='{{contacts}}'
      handle-as='json'>
    </iron-ajax>      
      <paper-header-panel mode='standard'>
        <paper-toolbar>
          <span class='main-title'>My contacts</span>
        </paper-toolbar>
      </paper-header-panel>     

      <section class='first-container'>
  		  <section class= 'contacts-view' active>          
          <template id='contactsView' is='dom-repeat' items='{{contacts.results}}'> 
            <contact-card contact="{{item}}">loading contact-card...</contact-card>
          </template> 
        </section>
        <section class='pagination-buttons'>          
          <template is='dom-if' if='{{!_pageNumber(page)}}'> 
            <p class= 'page-number'> Page {{page}}</p>           
            <paper-icon-button class='icon-next' icon='arrow-forward' on-tap='_selectNext'></paper-icon-button>
          </template>

          <template is='dom-if' if='{{_pageNumber(page)}}'>
            <paper-icon-button class='icon-previous' icon='arrow-back' on-tap='_selectPrevious'></paper-icon-button>
            <p class= 'page-number'> Page {{page}}</p> 
            <paper-icon-button class='icon-next' icon='arrow-forward' on-tap='_selectNext'></paper-icon-button>
          </template>
        </section>
      </section>

      <aside class='second-container'>
        <template id='asideView' is='dom-repeat' items='{{contacts.results}}' filter='_selectFavorite'> 
            <contact-small-card contact="{{item}}">loading contact-small-card...</contact-small-card>
        </template> 

        
      </aside>
      
    
    </template>

 <script>
    Polymer({
      is: 'app-element',
      properties:{
        contacts:{
          type: Object
        },
        count:{
          type: Number,
          value: 12
        },
        page:{
          type: Number,
          value:0
        },
        favorite:{
          type:Array
        }

      },
      listeners:{
        'remove-card' : '_removeCard'
      },

      _removeCard: function(ev, param){
        var index = this.contacts.results.indexOf(param.contact);
        this.contacts.results.splice(index,1);    
        this.$.contactsView.render();
        this.$.asideView.render();
      },
      _selectFavorite: function(item) { 
            
        if (!item.favorite){
          return false;
        } else {
          console.log("Favorite-true");
          return item;
        }
      },
      _selectNext: function(){
        this.page=this.page+1;
      },
      _selectPrevious: function(){
        this.page=this.page-1;
      },
      _pageNumber: function(index){
        return index>0;               
      }

    });
  </script>

</dom-module>